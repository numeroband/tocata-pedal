(this["webpackJsonptocata-pedal"]=this["webpackJsonptocata-pedal"]||[]).push([[0],{121:function(e,t,n){"use strict";n.r(t);var r=n(2),a=n(0),c=n.n(a),i=n(15),o=n.n(i),s=n(14),u=n(10),l=n(21),f=n(38),d=n(5),b=n.n(d),h=n(27),p=n(9),j=n(31),v=n(32),m=51966,x=function(){function e(t,n){var r=this;Object(j.a)(this,e),this.version=function(e){return{major:r.device?r.device.deviceVersionMajor:0,minor:r.device?r.device.deviceVersionMinor:0,subminor:r.device?r.device.deviceVersionSubminor:0}},this.usb=t,this.device=null,this.connectionEvent=n,t.onconnect=function(e){return r.onconnect(e)},t.ondisconnect=function(e){return r.ondisconnect(e)}}return Object(v.a)(e,[{key:"onconnect",value:function(){var e=Object(p.a)(d.mark((function e(t){return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.connected&&t.device.vendorId===m){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,console.log("Device found. Reconnecting..."),e.next=6,this.connectDevice(t.device);case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),console.log("Cannot connect",e.t0);case 11:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"ondisconnect",value:function(){var e=Object(p.a)(d.mark((function e(t){return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.device&&this.device===t.device){e.next=2;break}return e.abrupt("return");case 2:this.device=null,this.connectionEvent&&this.connectionEvent(!1);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"connect",value:function(){var e=Object(p.a)(d.mark((function e(){var t,n;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.reconnect();case 3:e.next=16;break;case 5:return e.prev=5,e.t0=e.catch(0),console.log("Connecting..."),t=[{vendorId:m}],e.next=11,this.usb.requestDevice({filters:t});case 11:if(n=e.sent){e.next=14;break}throw new Error("No device selected");case 14:return e.next=16,this.connectDevice(n);case 16:case"end":return e.stop()}}),e,this,[[0,5]])})));return function(){return e.apply(this,arguments)}}()},{key:"reconnect",value:function(){var e=Object(p.a)(d.mark((function e(){var t,n;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.connected){e.next=2;break}return e.abrupt("return");case 2:return console.log("Reconnecting..."),e.next=5,this.usb.getDevices();case 5:if(t=e.sent,n=t.find((function(e){return e.vendorId===m}))){e.next=9;break}throw new Error("No cached devices found");case 9:return e.next=11,this.connectDevice(n);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"connectDevice",value:function(){var e=Object(p.a)(d.mark((function e(t){var n=this;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.open();case 2:if(null!==t.configuration){e.next=5;break}return e.next=5,t.selectConfiguration(1);case 5:if(t.configuration.interfaces.forEach((function(e){e.alternates.forEach((function(t){255===t.interfaceClass&&(n.interfaceNumber=e.interfaceNumber,t.endpoints.forEach((function(e){"out"===e.direction&&(n.endpointOut=e.endpointNumber),"in"===e.direction&&(n.endpointIn=e.endpointNumber)})))}))})),this.endpointIn&&this.endpointOut){e.next=9;break}throw new Error("Cannot find USB device");case 9:return e.next=11,t.claimInterface(this.interfaceNumber);case 11:return e.next=13,t.controlTransferOut({requestType:"class",recipient:"interface",request:34,value:1,index:this.interfaceNumber});case 13:this.device=t,this.connectionEvent&&this.connectionEvent(!0);case 15:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=Object(p.a)(d.mark((function e(t){var n,r;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.buffer;case 1:if(!n){e.next=7;break}return n.byteLength>64?(r=n.slice(0,64),n=n.slice(64)):(r=n,n=null),e.next=5,this.device.transferOut(this.endpointOut,r);case 5:e.next=1;break;case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"receive",value:function(){var e=Object(p.a)(d.mark((function e(){var t,n;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.device.transferIn(this.endpointIn,64);case 2:return t=e.sent,n=t.data,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"connected",get:function(){return null!=this.device}}]),e}(),O=function(){function e(t,n){Object(j.a)(this,e),this.version=function(e){return{major:1,minor:2,subminor:3}},this.ws=t,this.socket=null,this.connectionEvent=n,this.queue=[],this.resolve=null}return Object(v.a)(e,[{key:"connect",value:function(){var e=Object(p.a)(d.mark((function e(){var t,n=this;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(t=new this.ws("ws://localhost:9002")).binaryType="arraybuffer",t.onopen=function(e){console.log("onopen"),n.socket=t,n.connectionEvent(!0)},t.onerror=function(e){console.log("onerror"),n.socket=null,n.connectionEvent(!1)},t.onmessage=function(e){n.queue.push(new Uint8Array(e.data)),n.resolve&&(n.resolve(n.queue.shift()),n.resolve=null)};case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"reconnect",value:function(){var e=Object(p.a)(d.mark((function e(){return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.connect());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"send",value:function(){var e=Object(p.a)(d.mark((function e(t){return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.socket.send(t);case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"receive",value:function(){var e=Object(p.a)(d.mark((function e(){var t=this;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.queue.length>0)){e.next=2;break}return e.abrupt("return",this.queue.shift());case 2:return e.abrupt("return",new Promise((function(e,n){t.resolve=e})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"connected",get:function(){return null!=this.socket}}]),e}(),g=function(){function e(t,n){var r=this;Object(j.a)(this,e),this.connect=function(e){return e?r.transport.reconnect():r.transport.connect()},this.version=function(e){return r.transport.version()},this.transport="requestDevice"in t?new x(t,n):new O(t,n),this.buffer=new Uint8Array}return Object(v.a)(e,[{key:"receive",value:function(){var e=Object(p.a)(d.mark((function e(){var t,n,r,a,c,i,o,s;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=1/0;case 1:if(!(this.buffer.byteLength<t)){e.next=14;break}return e.next=4,this.transport.receive();case 4:r=e.sent,a=this.buffer,this.buffer=new Uint8Array(a.byteLength+r.byteLength),this.buffer.set(a),this.buffer.set(new Uint8Array(r.buffer),a.byteLength),n=new DataView(this.buffer.buffer),c=this.buffer.byteLength>2?n.getUint16(0,!0):1/0,t=4+c,e.next=1;break;case 14:if(i=n.getUint8(2),o=n.getUint8(3),s=this.buffer.slice(4),this.buffer=this.buffer.byteLength>t?this.buffer.slice(t):new Uint8Array,0!==o){e.next=22;break}return e.abrupt("return",{command:i,status:o,data:s});case 22:throw new Error("Response with status ".concat(o));case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendRequest",value:function(){var e=Object(p.a)(d.mark((function e(t){var n,r,a,c=arguments;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:new Uint8Array,r=new Uint8Array(4+n.byteLength),(a=new DataView(r.buffer)).setUint16(0,n.byteLength,!0),a.setUint8(2,t),a.setUint8(3,0),r.set(n,4),e.next=9,this.transport.send(a);case 9:return e.next=11,this.receive();case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"connected",get:function(){return this.transport.connected}}]),e}(),y=n(83);var w={uint8:function(e,t){return[e.getUint8(t),t+1]},uint16:function(e,t){return[e.getUint16(t,!0),t+2]},uint32:function(e,t){return[e.getUint32(t,!0),t+4]},bool:function(e,t){return[0!==e.getUint8(t),t+1]},enum:function(e,t,n){return[n[e.getUint8(t)],t+1]},str:function(e,t,n){var r=new Uint8Array(e.buffer,t,n+1),a=r.findIndex((function(e){return 0===e}));return[String.fromCharCode.apply(null,r.slice(0,a)),t+n+1]},array:function(e,t,n,r){for(var a=[],c=arguments.length,i=new Array(c>4?c-4:0),o=4;o<c;o++)i[o-4]=arguments[o];for(var u=0;u<n;++u){var l=void 0,f=w[r].apply(w,[e,t].concat(i)),d=Object(s.a)(f,2);l=d[0],t=d[1],a[u]=l}return[a,t]},nArray:function(e,t){for(var n=e.getUint8(t++),r=arguments.length,a=new Array(r>2?r-2:0),c=2;c<r;c++)a[c-2]=arguments[c];var i=w.array.apply(w,[e,t].concat(a)),o=Object(s.a)(i,2),u=o[0],l=o[1];return[u.slice(0,n),l]},struct:function(e,t,n){var r,a,c={},i=Object(f.a)(n.fields);try{for(i.s();!(r=i.n()).done;){var o=Object(y.a)(r.value),u=o[0],l=o[1],d=o.slice(2),b=void 0;try{var p=w[l].apply(w,[e,t].concat(Object(h.a)(d))),j=Object(s.a)(p,2);b=j[0],t=j[1],null===(a=b)||"object"==typeof a&&0===a.length||"boolean"==typeof a&&!1===a||(c[u]=b)}catch(v){}}}catch(m){i.e(m)}finally{i.f()}return[n.valid&&!n.valid(c)?null:c,t]},u32Buffer:function(e,t){var n=e.getUint32(t,!0);return t+=4,[new Uint8Array(e.buffer,t,n),t+n]}},k={uint8:function(e,t,n){return e.setUint8(t,n),t+1},uint16:function(e,t,n){return e.setUint16(t,n,!0),t+2},uint32:function(e,t,n){return e.setUint32(t,n,!0),t+4},bool:function(e,t,n){return e.setUint8(t,n),t+1},enum:function(e,t,n,r){return e.setUint8(t,r.findIndex((function(e){return e===n}))),t+1},str:function(e,t,n,r){for(var a=n?n.length:0,c=0;c<a;++c)e.setUint8(t+c,n.charCodeAt(c));return e.setUint8(t+a,0),t+r+1},array:function(e,t,n,r,a){for(var c=arguments.length,i=new Array(c>5?c-5:0),o=5;o<c;o++)i[o-5]=arguments[o];for(var s=0;s<r;++s)t=k[a].apply(k,[e,t,n?n[s]:null].concat(i));return t},nArray:function(e,t,n){e.setUint8(t++,n?n.length:0);for(var r=arguments.length,a=new Array(r>3?r-3:0),c=3;c<r;c++)a[c-3]=arguments[c];return k.array.apply(k,[e,t,n].concat(a))},struct:function(e,t,n,r){n=!n||r.valid&&!r.valid(n)?{}:n;var a,c=Object(f.a)(r.fields);try{for(c.s();!(a=c.n()).done;){var i=Object(y.a)(a.value),o=i[0],s=i[1],u=i.slice(2);t=k[s].apply(k,[e,t,n[o]].concat(Object(h.a)(u)))}}catch(l){c.e(l)}finally{c.f()}return t},u32Buffer:function(e,t,n){return e.setUint32(t,n.byteLength,!0),t+=4,new Uint8Array(e.buffer,t).set(n),t+n.byteLength}},C={fields:[["wifi","struct",{fields:[["ssid","str",63],["key","str",63]],valid:function(e){return e.ssid}},function(e){return e.ssid}]]},A={fields:[["type","enum",[null,"PC","CC","NO","NF"]],["values","array",2,"uint8"]]},N={fields:[["id","uint8"],["names","nArray",16,"str",30]]},S={fields:[["id","uint8"],["program","struct",{fields:[["name","str",30],["fs","nArray",6,"struct",{fields:[["onActions","nArray",5,"struct",A],["offActions","nArray",5,"struct",A],["name","str",5],["color","enum",[null,"blue","purple","red","yellow","green","turquoise"]],["enabled","bool"],["momentary","bool"]],valid:function(e){return e.name}}],["actions","nArray",5,"struct",A],["mode","enum",["stomp","scene"]],["expression","uint8"]],valid:function(e){return e.name}}]]},U={fields:[["address","uint32"],["length","uint32"]]},E={fields:[["address","uint32"],["payload","u32Buffer"]]},P=function(e,t){return w.struct(new DataView(e),0,t)[0]},I=function(e,t,n){return e.slice(0,k.struct(new DataView(e),0,t,n))},R=function(e){return I(new Uint8Array(512).buffer,e,U)},L=function(){function e(t){var n=this;Object(j.a)(this,e),this.version=function(e){return n.protocol.version()},this.connect=function(e){return n.protocol.connect(e)},this.protocol=null,this.requestQueue=[],this.protocol=new g(t,(function(e){return n.connectionEvent&&n.connectionEvent(e)}))}return Object(v.a)(e,[{key:"sendRequest",value:function(e,t){var n=this;if(!this.connected)throw new Error("Not connected");var r={command:e,data:new Uint8Array(t)},a=new Promise((function(e,t){r.resolve=e,r.reject=t}));this.requestQueue.push(r);var c=function(){var e=Object(p.a)(d.mark((function e(){var t,r,a;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==n.requestQueue.length){e.next=2;break}return e.abrupt("return");case 2:return t=n.requestQueue[0],e.prev=3,e.next=6,n.protocol.sendRequest(t.command,t.data);case 6:r=e.sent,a=r.data,t.resolve(a.buffer),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(3),t.reject(e.t0);case 14:n.requestQueue.shift(),c();case 16:case"end":return e.stop()}}),e,null,[[3,11]])})));return function(){return e.apply(this,arguments)}}();return 1===this.requestQueue.length&&c(),a}},{key:"getConfig",value:function(){var e=Object(p.a)(d.mark((function e(){var t;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getConfig"),e.next=3,this.sendRequest(3);case 3:return t=e.sent,e.abrupt("return",P(t,C));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setConfig",value:function(){var e=Object(p.a)(d.mark((function e(t){var n;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("setConfig"),r=t,n=I(new Uint8Array(512).buffer,r,C),e.next=4,this.sendRequest(4,n);case 4:case"end":return e.stop()}var r}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteConfig",value:function(){var e=Object(p.a)(d.mark((function e(){return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleteConfig"),e.next=3,this.sendRequest(5);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getProgramNames",value:function(){var e=Object(p.a)(d.mark((function e(){var t,n,r;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("getProgramNames"),t=[];case 2:if(!(t.length<99)){e.next=10;break}return e.next=5,this.sendRequest(6,new Uint8Array([t.length]));case 5:n=e.sent,r=P(n,N),t.push.apply(t,Object(h.a)(r.names)),e.next=2;break;case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getProgram",value:function(){var e=Object(p.a)(d.mark((function e(t){var n,r,a;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getprogram",t),e.next=3,this.sendRequest(7,new Uint8Array([t]));case 3:return n=e.sent,r=P(n,S),a=r.program,e.abrupt("return",a||{});case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setProgram",value:function(){var e=Object(p.a)(d.mark((function e(t,n){var r;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("setprogram",t),a={id:t,program:n},r=I(new Uint8Array(512).buffer,a,S),e.next=4,this.sendRequest(8,r);case 4:case"end":return e.stop()}var a}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteProgram",value:function(){var e=Object(p.a)(d.mark((function e(t){return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleteProgram",t),e.next=3,this.sendRequest(9,new Uint8Array([t]));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"memRead",value:function(){var e=Object(p.a)(d.mark((function e(t,n){var r,a,c,i;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("memRead ".concat(t.toString(16)," - ").concat(n)),r=R({address:t,length:n}),e.next=4,this.sendRequest(16,r);case 4:return a=e.sent,c=P(a,E),i=c.payload,e.abrupt("return",i);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"memWrite",value:function(){var e=Object(p.a)(d.mark((function e(t,n){var r;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("memWrite ".concat(t.toString(16)," - ").concat(n.byteLength)),a={address:t,payload:n},r=I(new Uint8Array(512).buffer,a,E),e.next=4,this.sendRequest(17,r);case 4:case"end":return e.stop()}var a}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"flashErase",value:function(){var e=Object(p.a)(d.mark((function e(t,n){var r;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("flashErase ".concat(t.toString(16)," - ").concat(n)),r=R({address:t,length:n}),e.next=4,this.sendRequest(18,r);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"restart",value:function(){var e=Object(p.a)(d.mark((function e(){return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendRequest(1);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bootRom",value:function(){var e=Object(p.a)(d.mark((function e(){return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendRequest(2);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backup",value:function(){var e=Object(p.a)(d.mark((function e(){var t,n,r;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getConfig();case 2:return t=e.sent,e.next=5,this.getProgramNames();case 5:n=e.sent,t.programs=[],e.t0=d.keys(n);case 8:if((e.t1=e.t0()).done){e.next=16;break}if(r=e.t1.value,!n[r]){e.next=14;break}return e.next=13,this.getProgram(r);case 13:t.programs[r]=e.sent;case 14:e.next=8;break;case 16:return e.abrupt("return",t);case 17:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"restore",value:function(){var e=Object(p.a)(d.mark((function e(t){var n,r,a;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=t.programs,r=0;case 2:if(!(r<99)){e.next=14;break}if(!(a=n[r])||!a.name){e.next=9;break}return e.next=7,this.setProgram(r,a);case 7:e.next=11;break;case 9:return e.next=11,this.deleteProgram(r);case 11:++r,e.next=2;break;case 14:return e.next=16,this.setConfig(t);case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"factory",value:function(){var e=Object(p.a)(d.mark((function e(){var t;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<99)){e.next=7;break}return e.next=4,this.deleteProgram(t);case 4:++t,e.next=1;break;case 7:return e.next=9,this.deleteConfig();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"flashFirmware",value:function(){var e=Object(p.a)(d.mark((function e(t){var n,r,a;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.flashErase(t.flashStart,t.flashEnd-t.flashStart);case 2:n=Object(f.a)(t.blocks),e.prev=3,n.s();case 5:if((r=n.n()).done){e.next=11;break}return a=r.value,e.next=9,this.memWrite(a.address,a.payload);case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),n.e(e.t0);case 16:return e.prev=16,n.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[3,13,16,19]])})));return function(t){return e.apply(this,arguments)}}()},{key:"printBuffer",value:function(e,t){for(var n=0;n<t.byteLength;n+=16){var r=Math.min(16,t.byteLength-n),a=new Uint8Array(t,n,r),c=Array.prototype.map.call(a,(function(e){return e.toString(16).toUpperCase().padStart(2,"0")})).join(" "),i=(e+n).toString(16).toUpperCase().padStart(8,"0");console.log("".concat(i,": ").concat(c))}}},{key:"verifyFirmware",value:function(){var e=Object(p.a)(d.mark((function e(t){var n,r,a,c,i,o,s;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Object(f.a)(t.blocks),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=25;break}return a=r.value,e.next=7,this.memRead(a.address,a.payload.byteLength);case 7:if((c=e.sent).byteLength===a.payload.byteLength){e.next=10;break}throw new Error("Payload length does not match: local ".concat(a.payload.byteLength," != remote ").concat(c.byteLength));case 10:i=new Uint8Array(a.payload),o=new Uint8Array(c),s=0;case 13:if(!(s<a.payload.length)){e.next=23;break}if(i[s]===o[s]){e.next=20;break}throw console.log("local"),this.printBuffer(a.address,i.buffer),console.log("remote"),this.printBuffer(a.address,o.buffer),new Error("Payload difference in addr 0x".concat((a.address+s).toString(16)," local 0x").concat(i[s].toString(16)," != remote 0x").concat(o[s].toString(16)));case 20:++s,e.next=13;break;case 23:e.next=3;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(1),n.e(e.t0);case 30:return e.prev=30,n.f(),e.finish(30);case 33:case"end":return e.stop()}}),e,this,[[1,27,30,33]])})));return function(t){return e.apply(this,arguments)}}()},{key:"readMemory",value:function(){var e=Object(p.a)(d.mark((function e(t,n){var r,a,c,i,o;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=new Uint8Array(n),a=256,c=0;case 3:if(!(c<n)){e.next=12;break}return i=Math.min(a,n-c),e.next=7,this.memRead(t+c,i);case 7:o=e.sent,r.set(o,c);case 9:c+=a,e.next=3;break;case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"writeMemory",value:function(){var e=Object(p.a)(d.mark((function e(t,n){var r,a,c,i,o;return d.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=256,a=n.byteLength,c=0;case 3:if(!(c<a)){e.next=11;break}return i=Math.min(r,a-c),o=new Uint8Array(n,c,i),e.next=8,this.memWrite(t+c,o);case 8:c+=r,e.next=3;break;case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"connected",get:function(){return this.protocol.connected}}]),e}(),q=99,M=new URLSearchParams(window.location.search).get("transport")||"usb",D="ws"===M?new L(WebSocket):navigator.usb?new L(navigator.usb):null,F=function(){return"ws"===M||"usb"in navigator},B=function(e){return D.connect(e)},T=function(){return D.getConfig()},W=function(e){return D.setConfig(e)},V=function(){return D.deleteConfig()},J=function(){return D.getProgramNames()},z=function(e){return D.getProgram(e)},Q=function(e,t){return D.setProgram(e,t)},G=function(e){return D.deleteProgram(e)};function Y(e){return H.apply(this,arguments)}function H(){return(H=Object(p.a)(b.a.mark((function e(t){var n,r,a,c,i,o,s,u,l,f;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(e){n+=e,t&&t(n)},n=0,console.log("start readAll"),e.next=5,J();case 5:return a=e.sent,r(5),e.next=9,T();case 9:c=e.sent,i=c.wifi,r(5),o=a.reduce((function(e,t,n){return t?[].concat(Object(h.a)(e),[n]):e}),[]),s=[],u=(100-n)/o.length,e.t0=b.a.keys(o);case 16:if((e.t1=e.t0()).done){e.next=25;break}return l=e.t1.value,f=o[l],e.next=21,z(f);case 21:s[f]=e.sent,r(u),e.next=16;break;case 25:return t&&t(100),console.log("end readAll"),e.abrupt("return",{wifi:i,programs:s});case 28:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e,t){return X.apply(this,arguments)}function X(){return(X=Object(p.a)(b.a.mark((function e(t,n){var r,a,c,i,o,s,u,l;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o=function(e){i+=e,n&&n(i)},r=t.wifi,a=t.programs,c=void 0===a?[]:a,i=0,console.log("start updateAll"),s=1,u=0;case 6:if(!(u<q)){e.next=14;break}return l=c[u],e.next=10,l?Q(u,l):G(u);case 10:o(s);case 11:++u,e.next=6;break;case 14:return e.next=16,r?W({wifi:r}):V();case 16:o(1),console.log("end updateAll");case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return $.apply(this,arguments)}function $(){return($=Object(p.a)(b.a.mark((function e(t){var n,r,a,c;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=function(e){n+=e,t&&t(n)},n=0,console.log("start restore"),a=1,c=0;case 5:if(!(c<q)){e.next=12;break}return e.next=8,G(c);case 8:r(a);case 9:++c,e.next=5;break;case 12:return e.next=14,V();case 14:r(1),console.log("end restore");case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _(){return ee.apply(this,arguments)}function ee(){return(ee=Object(p.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("start restart"),e.next=3,D.restart();case 3:console.log("end restart");case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function te(e,t){return ne.apply(this,arguments)}function ne(){return(ne=Object(p.a)(b.a.mark((function e(t,n){var r,a,c,i,o,s;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=function(e){r+=e,n&&n(r)},r=0,console.log("start flashing"),e.next=5,D.flashErase(t.flashStart,t.flashEnd-t.flashStart);case 5:a(5),c=(100-r)/t.blocks.length,i=Object(f.a)(t.blocks),e.prev=8,i.s();case 10:if((o=i.n()).done){e.next=17;break}return s=o.value,e.next=14,D.memWrite(s.address,s.payload);case 14:a(c);case 15:e.next=10;break;case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(8),i.e(e.t0);case 22:return e.prev=22,i.f(),e.finish(22);case 25:console.log("end flashing");case 26:case"end":return e.stop()}}),e,null,[[8,19,22,25]])})))).apply(this,arguments)}function re(e,t){return ae.apply(this,arguments)}function ae(){return(ae=Object(p.a)(b.a.mark((function e(t,n){var r,a,c,i,o,s,u,l,d,h;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=function(e){r+=e,n&&n(r)},r=0,console.log("start verifying"),c=100/t.blocks.length,i=Object(f.a)(t.blocks),e.prev=5,i.s();case 7:if((o=i.n()).done){e.next=26;break}return s=o.value,e.next=11,D.memRead(s.address,s.payload.byteLength);case 11:if((u=e.sent).byteLength===s.payload.byteLength){e.next=14;break}throw new Error("Payload length does not match: local ".concat(s.payload.byteLength," != remote ").concat(u.byteLength));case 14:l=new Uint8Array(s.payload),d=new Uint8Array(u),h=0;case 17:if(!(h<s.payload.length)){e.next=23;break}if(l[h]===d[h]){e.next=20;break}throw new Error("Payload difference in addr 0x".concat((s.address+h).toString(16)," local 0x").concat(l[h].toString(16)," != remote 0x").concat(d[h].toString(16)));case 20:++h,e.next=17;break;case 23:a(c);case 24:e.next=7;break;case 26:e.next=31;break;case 28:e.prev=28,e.t0=e.catch(5),i.e(e.t0);case 31:return e.prev=31,i.f(),e.finish(31);case 34:console.log("end verifying");case 35:case"end":return e.stop()}}),e,null,[[5,28,31,34]])})))).apply(this,arguments)}var ce=n(169),ie=n(173),oe=n(168),se=n(166),ue=n(190),le=n(189),fe=n(171),de=n(167),be=n(123),he=n(164),pe=n(165),je=n(95),ve=n.n(je),me=n(170),xe=n(36),Oe=n(161),ge=n(18),ye=n(82),we=n(16),ke=240,Ce=Object(Oe.a)((function(e){return{root:{display:"flex"},drawer:Object(l.a)({},e.breakpoints.up("sm"),{width:ke,flexShrink:0}),appBar:Object(l.a)({},e.breakpoints.up("sm"),{width:"calc(100% - ".concat(ke,"px)"),marginLeft:ke}),menuButton:Object(l.a)({marginRight:e.spacing(2)},e.breakpoints.up("sm"),{display:"none"}),toolbar:e.mixins.toolbar,drawerPaper:{width:ke},content:{flexGrow:1,padding:e.spacing(3)}}}));function Ae(e){var t=e.icon,n=e.primary,a=e.to,i=e.index,o=e.onClick,s=c.a.useMemo((function(){return c.a.forwardRef((function(e,t){return Object(r.jsx)(ye.a,Object(u.a)({to:a,ref:t},e))}))}),[a]);return Object(r.jsx)("li",{children:Object(r.jsxs)(be.a,{button:!0,component:s,onClick:o,children:[t?Object(r.jsx)(he.a,{children:t}):null,Object(r.jsx)(pe.a,{primary:n})]})},i)}var Ne=function(e){var t,n=e.window,a=e.navigation,i=Ce(),o=Object(ge.a)(),u=c.a.useState(!1),l=Object(s.a)(u,2),f=l[0],d=l[1],b=c.a.useState(D&&D.connected),h=Object(s.a)(b,2),p=h[0],j=h[1];F()&&(t=function(e){console.log(e?"connected":"disconnected"),j(e)},D.connectionEvent=t),c.a.useEffect((function(){F()&&B(!0).catch((function(e){return console.log("Cannot reconnect",e)}))}),[]);var v=function(){console.log("handleDrawerToggle",f),d(!f)},m=Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{className:i.toolbar}),Object(r.jsx)(se.a,{}),Object(r.jsx)(de.a,{children:a.map((function(e,t){var n=e.path,a=e.name;return Object(r.jsx)(Ae,{to:n,primary:a,onClick:function(){return d(!1)}},t)}))})]}),x=void 0!==n?function(){return n().document.body}:void 0;return Object(r.jsx)(we.a,{children:Object(r.jsxs)("div",{className:i.root,children:[Object(r.jsx)(oe.a,{}),Object(r.jsx)(ce.a,{position:"fixed",className:i.appBar,children:Object(r.jsxs)(me.a,{children:[Object(r.jsx)(fe.a,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:v,className:i.menuButton,children:Object(r.jsx)(ve.a,{})}),Object(r.jsx)(xe.a,{variant:"h6",noWrap:!0,children:Object(r.jsx)(we.d,{children:function(e){var t=e.location,n=a.filter((function(e){var n=e.path;return t.pathname.startsWith(n)}));return n.length>0?n[0].title:"TocataPedal"}})})]})}),Object(r.jsxs)("nav",{className:i.drawer,"aria-label":"mailbox folders",children:[Object(r.jsx)(le.a,{smUp:!0,implementation:"css",children:Object(r.jsx)(ue.a,{container:x,variant:"temporary",anchor:"rtl"===o.direction?"right":"left",open:f,onClose:v,classes:{paper:i.drawerPaper},ModalProps:{keepMounted:!0},children:m})}),Object(r.jsx)(le.a,{xsDown:!0,implementation:"css",children:Object(r.jsx)(ue.a,{classes:{paper:i.drawerPaper},variant:"permanent",open:!0,children:m})})]}),Object(r.jsxs)("main",{className:i.content,children:[Object(r.jsx)("div",{className:i.toolbar}),Object(r.jsxs)(we.f,{children:[a.map((function(e,t){var n=e.path,a=e.content;return Object(r.jsx)(we.d,{path:n,children:F()?p?c.a.createElement(a,{}):Object(r.jsx)(ie.a,{color:"primary",variant:"contained",onClick:function(){return B().catch((function(e){return console.log("Cannot connect",e)}))},children:"Connect to device"}):Object(r.jsx)(xe.a,{children:"This browser doesn't support USB connections. Please use Google Chrome."})},t)})),Object(r.jsx)(we.c,{to:"/programs"})]})]})]})})},Se=n(188),Ue=n(174),Ee=n(175),Pe=n(176),Ie=n(177),Re=n(178),Le=n(179),qe=n(180),Me=n(181),De=n(182),Fe=n(191),Be=n(192),Te=n(183),We=Object(Oe.a)((function(e){return{root:{margin:e.spacing(1),minWidth:120},chip:{margin:e.spacing(.5,0)},card:{padding:e.spacing(1,2)}}}));function Ve(e){return Je[e.type].description(e)}var Je={PC:{name:"Program Change",values:[{name:"Program",min:1}],description:function(e){return"".concat(e.values[0])}},CC:{name:"Control Change",values:[{name:"Control",min:1},{name:"Value"}],description:function(e){return"".concat(e.values[0],":").concat(e.values[1])}}};function ze(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"PC",t={type:e,values:[0,0]};return Je[e].values.forEach((function(e,n){return t.values[n]=e.min||0})),t}function Qe(e){var t=e.id,n=e.action,c=e.setAction,i=e.onClose,o=e.open,l=We(),f=Object(a.useState)(n||ze("PC")),d=Object(s.a)(f,2),b=d[0],p=d[1];function j(e){var t=Object(h.a)(b.values);t[e.target.name]=e.target.value,p(Object(u.a)(Object(u.a)({},b),{},{values:t}))}function v(e){var t=Je[b.type].values[e];return t&&Object(r.jsx)(Se.a,{type:"number",label:t.name,className:l.root,name:"".concat(e),value:void 0===b.values[e]?t.min:b.values[e],onChange:j,inputProps:{min:void 0===t.min?0:t.min,max:void 0===t.max?127:t.max}})}return Object(a.useEffect)((function(){return p(n||ze("PC"))}),[n,o]),Object(r.jsxs)(Ue.a,{onClose:i,"aria-labelledby":"simple-dialog-title",open:o,children:[Object(r.jsx)(Ee.a,{id:"simple-dialog-title",children:"MIDI ACTION ".concat(Number(t)+1)}),Object(r.jsx)(Pe.a,{children:Object(r.jsxs)(Ie.a,{container:!0,direction:"column",alignItems:"flex-start",children:[Object(r.jsx)(Se.a,{label:"Type",select:!0,name:"type",value:b.type,className:l.led,onChange:function(e){var t=e.target.value;p(n&&n.type===t?n:ze(t))},children:Object.keys(Je).map((function(e,t){return Object(r.jsx)(Re.a,{value:e,children:Je[e].name},t)}))}),v(0),v(1)]})}),Object(r.jsxs)(Le.a,{children:[Object(r.jsx)(ie.a,{variant:"contained",color:"primary",onClick:i,children:"Cancel"}),Object(r.jsx)(ie.a,{variant:"contained",color:"primary",onClick:function(){c(t,b),i()},children:"Update"})]})]})}function Ge(e){var t=e.actions,n=e.setActions,c=e.title,i=We(),o=Object(a.useState)(!1),l=Object(s.a)(o,2),f=l[0],d=l[1],b=Object(a.useState)({actions:t}),p=Object(s.a)(b,2),j=p[0],v=p[1];function m(e){var t=j.actions?j.actions[e]:null;v(Object(u.a)(Object(u.a)({},j),{},{id:e,action:t})),d(!0)}return Object(a.useEffect)((function(){return v({actions:t})}),[t]),Object(r.jsxs)(qe.a,{className:i.root,children:[Object(r.jsx)(Me.a,{className:i.card,title:c,titleTypographyProps:{variant:"subtitle1"}}),Object(r.jsx)(De.a,{className:i.card,children:Object(r.jsx)(Ie.a,{container:!0,direction:"column",alignItems:"flex-start",children:t&&t.length>0?t.map((function(e,t){return Object(r.jsx)(Fe.a,{className:i.chip,avatar:Object(r.jsx)(Be.a,{children:e.type}),variant:"outlined",label:Ve(e),clickable:!0,onClick:function(){return m(t)},onDelete:function(){return function(e){var t=Object(h.a)(j.actions);t.splice(e,1),v(Object(u.a)(Object(u.a)({},j),{},{actions:t})),n(t)}(t)}},t)})):"No actions"})}),Object(r.jsx)(Te.a,{children:Object(r.jsx)(ie.a,{color:"primary",variant:"contained",size:"small",onClick:function(){m(t?t.length:0)},children:"Add"})}),Object(r.jsx)(Qe,{id:j.id,action:j.action,setAction:function(e,t){var r=j.actions||[];r[e]=t,v({actions:r,id:e,action:t}),n(r)},open:f,onClose:function(){return d(!1)}})]})}var Ye=n(184),He=n(193),Ke=n(185),Xe=n(72),Ze=n.n(Xe),$e=n(73),_e=n.n($e),et="A".charCodeAt(0),tt=["blue","purple","red","yellow","green","turquoise"],nt=Object(Oe.a)((function(e){return{root:{margin:e.spacing(1),minWidth:120},led:{margin:e.spacing(1)},icon:{margin:e.spacing(2,0,0,1)},fsEntry:{float:"left",width:90}}}));function rt(e){var t=e.color;return Object(r.jsx)("div",{style:{width:15,height:15,borderWidth:1,borderStyle:"solid",borderRadius:"50%",backgroundColor:t,float:"left"}})}function at(e){var t=e.id,n=e.footswitch,c=e.setFootswitch,i=e.onClose,o=e.open,f=nt(),d=Object(a.useMemo)((function(){return{name:"",color:tt[0],enabled:!1,momentary:!1,onActions:[],offActions:[]}}),[]),b=Object(a.useState)(Object(u.a)(Object(u.a)({},d),n)),h=Object(s.a)(b,2),p=h[0],j=h[1];function v(e){j(Object(u.a)(Object(u.a)({},p),{},Object(l.a)({},e.target.name,e.target.value)))}function m(e){j(Object(u.a)(Object(u.a)({},p),{},Object(l.a)({},e.target.name,e.target.checked)))}return Object(a.useEffect)((function(){return j(Object(u.a)(Object(u.a)({},d),n))}),[n,d]),Object(r.jsxs)(Ue.a,{onClose:i,"aria-labelledby":"simple-dialog-title",open:o,children:[Object(r.jsx)(Ee.a,{id:"simple-dialog-title",children:"FOOTSWITCH ".concat(String.fromCharCode(et+Number(t)))}),Object(r.jsx)(Pe.a,{children:Object(r.jsxs)(Ie.a,{container:!0,direction:"column",alignItems:"flex-start",children:[Object(r.jsx)(Se.a,{label:"Footswitch name",className:f.root,name:"name",value:p.name,onChange:v,inputProps:{maxLength:5}}),Object(r.jsx)(Se.a,{label:"Color",select:!0,name:"color",value:p.color,className:f.led,onChange:v,children:tt.map((function(e,t){return Object(r.jsx)(Re.a,{value:e,children:Object(r.jsx)(rt,{color:e})},t)}))}),Object(r.jsx)(Ye.a,{className:f.root,control:Object(r.jsx)(He.a,{checked:p.enabled,name:"enabled",onChange:m}),label:"Default On"}),Object(r.jsx)(Ye.a,{className:f.root,control:Object(r.jsx)(He.a,{checked:p.momentary,name:"momentary",onChange:m}),label:"Momentary"})]})}),Object(r.jsxs)(Le.a,{children:[Object(r.jsx)(ie.a,{variant:"contained",color:"primary",onClick:i,children:"Cancel"}),Object(r.jsx)(ie.a,{variant:"contained",color:"primary",onClick:function(){c(t,p),i()},disabled:!p.name,children:"Update"})]})]})}function ct(e){var t=e.id,n=e.mode,a=e.footswitch,c=void 0===a?{}:a,i=e.setFootswitch;return c&&c.name?Object(r.jsxs)(Ie.a,{container:!0,direction:"row",alignItems:"flex-start",children:[Object(r.jsx)(Ge,{actions:c.onActions,setActions:function(e){return i(t,Object(u.a)(Object(u.a)({},c),{},{onActions:e}))},title:"scene"===n?"Scene MIDI":"On MIDI"}),"scene"===n?Object(r.jsx)("div",{}):Object(r.jsx)(Ge,{actions:c.offActions,setActions:function(e){return i(t,Object(u.a)(Object(u.a)({},c),{},{offActions:e}))},title:"Off MIDI"})]}):Object(r.jsx)("div",{})}function it(e){var t=e.mode,n=e.footswitches,c=e.setFootswitches,i=nt(),o=Object(a.useState)(g(n)),l=Object(s.a)(o,2),f=l[0],d=l[1],b=Object(a.useState)(!1),h=Object(s.a)(b,2),p=h[0],j=h[1],v=Object(a.useState)(0),m=Object(s.a)(v,2),x=m[0],O=m[1];function g(e){for(var t=e.map((function(e){return e?{name:e.name,color:e.color}:null})),n=t.length;n<6;++n)t.push(null);return t}function y(e,t){var r=t?Object(u.a)({},t):null;for(r&&!n[e]&&(r.onActions=[{type:"CC",values:[Number(e)+32,127]}],r.offActions=[{type:"CC",values:[Number(e)+32,0]}]),r&&(r.enabled||delete r.enabled,r.momentary||delete r.momentary,r.onActions&&0===r.onActions.length&&delete r.onActions,r.offActions&&0===r.offActions.length&&delete r.offActions),n[e]=r;n.length>0&&!n[n.length-1];)n.pop();c(n),d(g(n))}Object(a.useEffect)((function(){return d(g(n))}),[n]);return Object(r.jsxs)(Ie.a,{children:[Object(r.jsxs)(Ie.a,{children:[Object(r.jsx)(Se.a,{label:"Footswitch",className:i.root,select:!0,value:x,onChange:function(e){var t=e.target.value;O(t)},children:f.map((function(e,t){return Object(r.jsx)(Re.a,{value:t,children:Object(r.jsxs)("div",{children:[Object(r.jsx)("div",{className:i.fsEntry,children:"".concat(String.fromCharCode(et+t)," - ").concat(e?e.name:"<EMPTY>")}),e?Object(r.jsx)(rt,{color:e.color}):Object(r.jsx)("div",{})]})},t)}))}),Object(r.jsx)(Ke.a,{className:i.icon,size:"small",color:"primary","aria-label":"edit",onClick:function(){return j(!0)},children:Object(r.jsx)(Ze.a,{})}),Object(r.jsx)(Ke.a,{className:i.icon,size:"small",color:"secondary","aria-label":"delete",onClick:function(){return y(x,null)},children:Object(r.jsx)(_e.a,{})}),Object(r.jsx)(at,{id:x,footswitch:n[x],setFootswitch:y,open:p,onClose:function(){return j(!1)}})]}),Object(r.jsx)(ct,{id:x,mode:t,footswitch:n[x],setFootswitch:y})]})}var ot=n(186),st="Are you sure you want to discard the changes made to this program?",ut=function(e){return 0===(128&e)},lt=function(e){return-129&e&255},ft=function(e){return 255&(128|e)},dt=Object.freeze({stomp:"stomp",scene:"scene"}),bt=Object(Oe.a)((function(e){return{root:{margin:e.spacing(1),minWidth:120},icon:{margin:e.spacing(2,0,0,1)},switch:{marginTop:20}}})),ht=function(e,t){return"".concat(Number(t)+1," - ").concat(e||"<EMPTY>")};function pt(e,t){if(e===t)return!0;if("object"!=typeof e||"object"!=typeof t||null==e||null==t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(var a=0,c=n;a<c.length;a++){var i=c[a];if(!r.includes(i)||!pt(e[i],t[i]))return!1}return!0}function jt(e){var t=e.id,n=e.program,c=e.setProgram,i=e.onClose,o=e.open,f=bt(),d=Object(a.useMemo)((function(){return{name:"",mode:dt.stomp,expression:ft(40),actions:[],fs:[]}}),[]),b=Object(a.useState)(Object(u.a)(Object(u.a)({},d),n)),h=Object(s.a)(b,2),p=h[0],j=h[1];Object(a.useEffect)((function(){return j(Object(u.a)(Object(u.a)({},d),n))}),[n,d]);var v=function(e){return j(Object(u.a)(Object(u.a)({},p),{},Object(l.a)({},e.target.name,e.target.value)))};var m=[{value:dt.stomp,name:"Stomp"},{value:dt.scene,name:"Scene"}];return Object(r.jsxs)(Ue.a,{onClose:i,"aria-labelledby":"simple-dialog-title",open:o,children:[Object(r.jsx)(Ee.a,{id:"simple-dialog-title",children:"PROGRAM ".concat(Number(t)+1)}),Object(r.jsx)(Pe.a,{children:Object(r.jsxs)(Ie.a,{container:!0,direction:"column",alignItems:"flex-start",children:[Object(r.jsx)(Se.a,{label:"Name",name:"name",className:f.root,value:p.name,onChange:v,inputProps:{maxLength:30}}),Object(r.jsx)(Se.a,{label:"Mode",name:"mode",className:f.root,select:!0,value:p.mode||dt.stomp,onChange:v,children:m.map((function(e,t){return Object(r.jsx)(Re.a,{value:e.value,children:e.name},t)}))}),Object(r.jsxs)("div",{children:[Object(r.jsx)(Se.a,{type:"number",label:"Expression CC",className:f.root,disabled:!ut(p.expression),name:"expression",value:lt(p.expression),onChange:function(e){return j(Object(u.a)(Object(u.a)({},p),{},Object(l.a)({},e.target.name,Number(e.target.value))))},inputProps:{min:0,max:127}}),Object(r.jsx)(He.a,{className:f.switch,checked:ut(p.expression),name:"expression",onChange:function(e){var t=e.target.checked?lt:ft;j((function(n){return Object(u.a)(Object(u.a)({},n),{},Object(l.a)({},e.target.name,t(n.expression)))}))}})]})]})}),Object(r.jsxs)(Le.a,{children:[Object(r.jsx)(ie.a,{variant:"contained",color:"primary",onClick:i,children:"Cancel"}),Object(r.jsx)(ie.a,{variant:"contained",color:"primary",onClick:function(){c(t,p),i()},disabled:!p.name,children:"Update"})]})]})}function vt(e){var t=e.id,n=e.program,c=e.setProgram;n.name||(n.actions=[{type:"PC",values:[Number(t)+1]}]);var i=Object(a.useMemo)((function(){return{name:"",actions:[],fs:[]}}),[]),o=Object(a.useState)(Object(u.a)(Object(u.a)({},i),n)),l=Object(s.a)(o,2),f=l[0],d=l[1];return Object(a.useEffect)((function(){d(Object(u.a)(Object(u.a)({},i),n))}),[n,i]),n.name?Object(r.jsxs)(Ie.a,{container:!0,direction:"column",alignItems:"flex-start",children:[Object(r.jsx)(Ge,{actions:n.actions,setActions:function(e){return c(t,Object(u.a)(Object(u.a)({},n),{},{actions:e}))},title:"Program MIDI"}),Object(r.jsx)(it,{mode:f.mode,footswitches:f.fs?f.fs:[],setFootswitches:function(e){var n=Object(u.a)(Object(u.a)({},f),{},{fs:e});d(n),c(t,n)}})]}):Object(r.jsx)("div",{})}function mt(){var e=bt(),t=new URLSearchParams(Object(we.j)().search).get("id")||0,n=Object(we.i)(),c=Object(a.useState)(null),i=Object(s.a)(c,2),o=i[0],u=i[1],l=Object(a.useState)(!1),f=Object(s.a)(l,2),d=f[0],j=f[1],v=Object(a.useState)(null),m=Object(s.a)(v,2),x=m[0],O=m[1],g=Object(a.useState)(null),y=Object(s.a)(g,2),w=y[0],k=y[1],C=Object(we.k)().path;Object(a.useEffect)((function(){function e(){return(e=Object(p.a)(b.a.mark((function e(){var t;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u(null),e.next=3,J();case 3:t=e.sent,u(t.map(ht));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),Object(a.useEffect)((function(){function e(){return(e=Object(p.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return O(null),e.next=3,z(t);case 3:n=e.sent,O(n),k(JSON.parse(JSON.stringify(n)));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(t){e.apply(this,arguments)}(t)}),[t]);var A=function(){return w&&x&&!pt(N(w),N(x))};function N(e){return e?(e.fs&&0===e.fs.length&&delete e.fs,e.actions&&0===e.actions.length&&delete e.actions,e):null}function S(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n){var r=N(t);k(r),Q(e,r)}t||G(e);var a=Object(h.a)(o);a[e]=ht(t?t.name:null,e),u(a),O(t||{})}return o?Object(r.jsxs)("div",{children:[Object(r.jsx)(we.b,{when:x&&A(),message:function(){return st}}),Object(r.jsxs)("div",{children:[Object(r.jsx)(Se.a,{label:"Program",className:e.root,select:!0,value:t,onChange:function(e){var r=e.target.value;r!==t&&(x.name&&A()?window.confirm(st)&&(S(t,w),n.push("".concat(C,"?id=").concat(r))):n.push("".concat(C,"?id=").concat(r)))},children:o.map((function(e,t){return Object(r.jsx)(Re.a,{value:t,children:e},t)}))}),Object(r.jsx)(Ke.a,{className:e.icon,size:"small",color:"primary","aria-label":"edit",disabled:!x,onClick:function(){return j(!0)},children:Object(r.jsx)(Ze.a,{})}),Object(r.jsx)(Ke.a,{className:e.icon,size:"small",color:"secondary","aria-label":"delete",disabled:!x||!x.name,onClick:function(){return S(t,null)},children:Object(r.jsx)(_e.a,{})}),Object(r.jsx)(jt,{id:t,program:x,setProgram:S,open:d,onClose:function(){return j(!1)}})]}),Object(r.jsx)(se.a,{}),x?Object(r.jsx)(vt,{id:t,program:x,setProgram:S}):Object(r.jsx)(ot.a,{}),x&&x.name&&Object(r.jsxs)(Ie.a,{children:[Object(r.jsx)(se.a,{}),Object(r.jsx)(ie.a,{color:"primary",variant:"contained",className:e.root,disabled:!A(),onClick:function(){return S(t,x,!0)},children:"Save"}),Object(r.jsx)(ie.a,{color:"secondary",variant:"contained",className:e.root,disabled:!A(),onClick:function(){return S(t,JSON.parse(JSON.stringify(w)))},children:"Discard"})]})]}):Object(r.jsx)(ot.a,{})}var xt=Object(Oe.a)((function(e){return{root:{margin:e.spacing(1),minWidth:120}}}));function Ot(){var e=xt(),t=Object(a.useState)(null),n=Object(s.a)(t,2),c=n[0],i=n[1],o=Object(a.useState)(!1),f=Object(s.a)(o,2),d=f[0],h=f[1];function j(){return(j=Object(p.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(!0),e.next=3,W(c);case 3:h(!1);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){var t=e.target.name.split("."),n=Object(s.a)(t,2),r=n[0],a=n[1];i(Object(u.a)(Object(u.a)({},c),{},Object(l.a)({},r,Object(u.a)(Object(u.a)({},c[r]),{},Object(l.a)({},a,e.target.value)))))}return Object(a.useEffect)((function(){function e(){return(e=Object(p.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(null),e.t0=i,e.next=4,T();case 4:e.t1=e.sent,(0,e.t0)(e.t1);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]),c?Object(r.jsxs)("div",{children:[Object(r.jsxs)("div",{children:[Object(r.jsx)(Se.a,{label:"SSID",className:e.root,name:"wifi.ssid",value:c.wifi?c.wifi.ssid:"",onChange:v}),Object(r.jsx)(Se.a,{label:"Key",className:e.root,name:"wifi.key",value:c.wifi?c.wifi.key:"",onChange:v})]}),Object(r.jsx)(ie.a,{variant:"contained",color:"primary",className:e.root,onClick:function(){return j.apply(this,arguments)},disabled:d,children:"Save"})]}):Object(r.jsx)(ot.a,{})}var gt=Object(Oe.a)((function(e){return{root:{margin:e.spacing(1),minWidth:150}}}));function yt(){var e=gt(),t=Object(a.useState)(-1),n=Object(s.a)(t,2),c=n[0],i=n[1];function o(){return(o=Object(p.a)(b.a.mark((function e(){var t,n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(0),e.next=3,Y(i);case 3:t=e.sent,(n=document.createElement("a")).setAttribute("href","data:text/json;charset=utf-8,".concat(encodeURIComponent(JSON.stringify(t,null,2)))),n.setAttribute("download","TocataConfig.json"),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),i(-1);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function u(){return(u=Object(p.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(0),e.next=3,Z(i);case 3:i(-1);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(r.jsxs)("div",{children:[Object(r.jsxs)(Ie.a,{container:!0,direction:"column",alignItems:"flex-start",children:[Object(r.jsx)(ie.a,{color:"primary",variant:"contained",className:e.root,onClick:function(){return o.apply(this,arguments)},disabled:c>=0,children:"Backup"}),Object(r.jsx)("input",{accept:"application/JSON",id:"restore-file",type:"file",onChange:function(e){var t=e.target.files;if(t.length<=0)return!1;var n=new FileReader;n.onload=function(){var e=Object(p.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=JSON.parse(t.target.result)){e.next=4;break}return alert("Invalid configuration"),e.abrupt("return",!1);case 4:return i(0),e.next=7,K(n,i);case 7:i(-1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.readAsText(t.item(0))},hidden:!0}),Object(r.jsx)("label",{htmlFor:"restore-file",children:Object(r.jsx)(ie.a,{color:"secondary",variant:"contained",component:"span",disabled:c>=0,className:e.root,children:"Restore"})}),Object(r.jsx)(ie.a,{color:"primary",variant:"contained",className:e.root,onClick:function(){return u.apply(this,arguments)},disabled:c>=0,children:"Factory Reset"})]}),Object(r.jsx)("div",{children:c>=0&&Object(r.jsx)(ot.a,{variant:"determinate",value:c})})]})}var wt=function(){function e(t){if(Object(j.a)(this,e),0===t.byteLength||t.byteLength%512!==0)throw new Error("Invalid UF2 size");this.buffer=t;var n=t.byteLength/512;this.flashStart=1/0,this.flashEnd=0,this.blocks=[];for(var r=0;r<n;++r){var a=this.getBlock(r);this.flashStart=Math.min(this.flashStart,a.address),this.flashEnd=Math.max(this.flashEnd,a.address+a.payload.byteLength),this.blocks.push(a)}}return Object(v.a)(e,[{key:"getBlock",value:function(e){if(e>=this.numBlocks)throw new Error("".concat(e,": Invalid block index"));var t=512*e,n=new DataView(this.buffer,t);if(171066965!==n.getUint32(0,!0))throw new Error("".concat(e,": Invalid block first magic"));if(2656915799!==n.getUint32(4,!0))throw new Error("".concat(e,": Invalid block second magic"));if(8192!==n.getUint32(8,!0))throw new Error("".concat(e,": Invalid block flags"));var r=n.getUint32(16,!0);if(r>476)throw new Error("".concat(e,": Invalid block payload size"));if(3834380118!==n.getUint32(28,!0))throw new Error("".concat(e,": Invalid block family id"));if(179400496!==n.getUint32(508,!0))throw new Error("".concat(e,": Invalid block final magic"));return{address:n.getUint32(12,!0),payload:new Uint8Array(this.buffer,t+32,r)}}}]),e}(),kt=Object(Oe.a)((function(e){return{root:{margin:e.spacing(1),minWidth:170}}}));function Ct(){var e=kt(),t=Object(a.useState)(-1),n=Object(s.a)(t,2),c=n[0],i=n[1];function o(){return(o=Object(p.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i(0),e.next=3,_();case 3:i(-1);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var u=D.version(),l=u.major,f=u.minor,d=u.subminor;return Object(r.jsxs)("div",{children:[Object(r.jsxs)(Ie.a,{container:!0,direction:"column",alignItems:"flex-start",children:[Object(r.jsxs)("h3",{children:["Version: ",l,".",f,".",d]}),Object(r.jsx)("input",{accept:".uf2",id:"restore-file",type:"file",onChange:function(e){var t=e.target.files;if(t.length<=0)return!1;i(0);var n=new FileReader;n.onload=function(){var e=Object(p.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new wt(t.target.result),e.next=4,te(n,(function(e){return i(e/2)}));case 4:return e.next=6,re(n,(function(e){return i(50+e/2)}));case 6:return e.next=8,_();case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0);case 13:i(-1);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}(),n.readAsArrayBuffer(t.item(0))},hidden:!0}),Object(r.jsx)("label",{htmlFor:"restore-file",children:Object(r.jsx)(ie.a,{color:"primary",variant:"contained",component:"span",disabled:c>=0,className:e.root,children:"Firmware update"})}),Object(r.jsx)(ie.a,{color:"secondary",variant:"contained",className:e.root,onClick:function(){return o.apply(this,arguments)},disabled:c>=0,children:"Restart"})]}),Object(r.jsx)("div",{children:c>=0&&Object(r.jsx)(ot.a,{variant:"determinate",value:c})})]})}var At=n(172),Nt=n(96),St=n(187);function Ut(){var e=Object(At.a)("(prefers-color-scheme: dark)"),t=Object(a.useMemo)((function(){return Object(Nt.a)({palette:{type:e?"dark":"light"}})}),[e]),n=[{path:"/programs",name:"Programs",title:"Programs",content:mt},{path:"/config",name:"Configuration",title:"System configuration",content:Ot},{path:"/backup",name:"Backup",title:"Backup / Restore",content:yt},{path:"/firmware",name:"Firmware",title:"Firmware update",content:Ct}];return Object(r.jsxs)(St.a,{theme:t,children:[Object(r.jsx)(oe.a,{}),Object(r.jsx)(Ne,{navigation:n})]})}var Et=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,194)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),c(e),i(e)}))};o.a.render(Object(r.jsx)(Ut,{}),document.getElementById("root")),Et()}},[[121,1,2]]]);